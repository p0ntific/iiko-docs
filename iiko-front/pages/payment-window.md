# Окно расчета (оплата заказа)

## Краткое описание

Универсальный интерфейс для проведения оплаты заказов в системе iiko Front. Поддерживает различные способы оплаты, работает как в ресторанном, так и в фастфуд режиме, обеспечивает интеграцию с фискальными регистраторами и банковскими терминалами.

## Функциональные элементы

### Основные компоненты страницы

- **Детали заказа** - состав заказа с ценами
- **Итоговая сумма** - общая стоимость с учетом скидок/надбавок
- **Способы оплаты** - наличные, карты, комбинированная оплата
- **Калькулятор сдачи** - расчет сдачи при оплате наличными
- **Панель скидок** - применение различных типов скидок
- **Кнопки действий** - завершение оплаты, отмена, печать

### Способы оплаты

- **Наличные** - расчет наличными деньгами
- **Банковские карты** - безналичный расчет через эквайринг
- **Комбинированная оплата** - частично наличными, частично картой
- **Электронные кошельки** - мобильные платежи
- **Подарочные карты** - оплата сертификатами заведения
- **Бонусные баллы** - списание накопленных бонусов
- **Корпоративные счета** - оплата юридическими лицами

### Дополнительные функции

- **Чаевые** - добавление чаевых к счету
- **Округление** - округление суммы до удобных значений
- **Разделение счета** - оплата по частям разными способами
- **Возврат средств** - процедуры возврата при необходимости

## Связи с другими страницами

### Входящие переходы

- **[Окно заказа (ресторан)](./restaurant-order.md)** → кнопка "Расчет"
- **[Окно заказа (фастфуд)](./fastfood-order.md)** → завершение заказа
- **[Режим табов](./tabs-mode.md)** → закрытие таба
- **[Управление столами](./table-management.md)** → расчет со стола

### Исходящие переходы

- **Успешная оплата** → Возврат к соответствующей главной странице
- **Печать документов** → Интерфейс печати чеков и заказов
- **Возврат товара** → [Возврат товара](./product-return.md)
- **Отмена операции** → Возврат к окну заказа

### Контекстные переходы

- **Проблема с оплатой** → Диагностика платежных систем
- **Необходимость скидки** → Система авторизации скидок
- **Чек коррекции** → [Чек коррекции](./correction-receipt.md)

## Бизнес-правила

### Процесс оплаты

1. **Подтверждение заказа** - финальная проверка состава и суммы
2. **Выбор способа оплаты** - наличные, карта или комбинированно
3. **Применение скидок** - если не применены ранее
4. **Расчет итоговой суммы** - с учетом всех модификаторов
5. **Проведение платежа** - обработка транзакции
6. **Печать документов** - фискальный чек, заказ для кухни
7. **Завершение операции** - закрытие заказа в системе

### Валидация платежа

- **Достаточность средств** - проверка лимитов карт
- **Корректность данных** - валидация платежной информации
- **Фискальные требования** - соответствие налоговому законодательству
- **Лимиты операций** - проверка дневных и разовых лимитов

### Обработка ошибок

- **Отклонение карты** - предложение альтернативных способов
- **Сбой связи** - повторные попытки или офлайн режим
- **Недостаток наличных** - уведомление о необходимости пополнения
- **Технические проблемы** - процедуры восстановления

## UX/UI требования

### Визуальные состояния

- **Обычное состояние** - готовность к оплате
- **Состояние оплаты** - процесс проведения платежа
- **Состояние ошибки** - отображение проблем с оплатой
- **Состояние успеха** - подтверждение успешной оплаты

### Анимации

- Плавные переходы между способами оплаты
- Анимация загрузки при проведении платежа
- Пульсация кнопки при готовности к оплате
- Fade-in для уведомлений об ошибках

### Адаптивность

- Оптимизация для сенсорных экранов касс
- Крупные кнопки для быстрого нажатия
- Четкие контрасты для читаемости
- Поддержка различных размеров экранов

## Различия по ролям

### Кассир

- Полный доступ к функциям оплаты
- Применение скидок в рамках лимитов
- Проведение возвратов

### Менеджер

- Дополнительно: применение любых скидок
- Авторизация крупных операций
- Доступ к отчетам по оплатам

## Критерии готовности

- [ ] Все способы оплаты работают корректно
- [ ] Расчет сдачи происходит точно
- [ ] Применение скидок функционирует правильно
- [ ] Печать документов работает стабильно
- [ ] Интеграция с фискальными регистраторами настроена
- [ ] Обработка ошибок происходит корректно
- [ ] Адаптивная верстка на всех устройствах

## Оценка сложности

**Высокая сложность** - комплексный интерфейс оплаты с множественными интеграциями и требованиями к безопасности.
