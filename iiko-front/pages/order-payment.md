# Оплата заказа

## Краткое описание

Универсальная система обработки платежей в iiko Front. Обеспечивает прием оплаты различными способами, включая наличные, банковские карты, электронные кошельки и комбинированные платежи с полной фискализацией операций.

## Функциональные элементы

### Основные компоненты страницы

- **Сумма к оплате** - отображение итоговой стоимости заказа
- **Способы оплаты** - доступные методы расчета
- **Калькулятор сдачи** - расчет сдачи при наличной оплате
- **Разделение платежа** - комбинированная оплата несколькими способами
- **Применение скидок** - финальные корректировки суммы
- **Фискализация** - печать чека и передача в ОФД

### Способы оплаты

- **Наличные** - оплата наличными деньгами
- **Банковские карты** - оплата через эквайринг
- **Электронные кошельки** - Apple Pay, Google Pay, Samsung Pay
- **Подарочные сертификаты** - использование сертификатов заведения
- **Бонусные баллы** - списание из программы лояльности
- **Корпоративные платежи** - безналичный расчет для юридических лиц
- **Комбинированная оплата** - несколько способов одновременно

### Статусы платежа

- **Ожидает оплаты** - заказ готов к расчету
- **Обрабатывается** - платеж в процессе
- **Оплачен** - успешная оплата
- **Отклонен** - неуспешная попытка оплаты
- **Частично оплачен** - при комбинированной оплате
- **Возвращен** - возврат средств

## Связи с другими страницами

### Входящие переходы

- **[Окно заказа (фастфуд)](./fastfood-order.md)** → переход к оплате
- **[Окно заказа (ресторан)](./restaurant-order.md)** → оплата за столом
- **[Окно расчета](./payment-window.md)** → финальная оплата
- **[Табы](./tabs-mode.md)** → оплата отложенного заказа

### Исходящие переходы

- **Успешная оплата** → [Кассовая смена](./cash-shift.md)
- **Печать чека** → Фискальное оборудование
- **Ошибки оплаты** → Система уведомлений
- **Возврат средств** → [Возврат товара](./product-return.md)

### Контекстные переходы

- **Отклоненный платеж** → Выбор альтернативного способа оплаты
- **Технические проблемы** → Диагностика оборудования
- **Частичная оплата** → Добавление дополнительных способов

## Бизнес-правила

### Процесс оплаты

1. **Подготовка к оплате** - формирование итоговой суммы заказа
2. **Выбор способа оплаты** - отображение доступных методов
3. **Обработка платежа** - взаимодействие с платежными системами
4. **Завершение операции** - фискализация и печать чека

### Правила валидации

- **Минимальная сумма** - ограничения по способам оплаты
- **Максимальная сумма** - дневные и разовые лимиты
- **Доступность способов** - в зависимости от времени и настроек
- **Комиссии** - автоматический расчет банковских комиссий

### Обработка ошибок

- **Недостаточно средств** - отказ банка или платежной системы
- **Технические ошибки** - сбои связи или оборудования
- **Превышение лимитов** - нарушение установленных ограничений
- **Истечение времени** - таймаут операции

## UX/UI требования

### Визуальные состояния

- **Обычное состояние** - готовность к оплате
- **Состояние обработки** - процесс проведения платежа
- **Состояние ошибки** - отображение проблем с оплатой
- **Состояние успеха** - подтверждение успешной оплаты

### Анимации

- Плавные переходы между способами оплаты
- Анимация загрузки при проведении платежа
- Пульсация кнопки при готовности к оплате
- Fade-in для уведомлений об ошибках

### Адаптивность

- Оптимизация для сенсорных экранов касс
- Крупные кнопки для быстрого нажатия
- Четкие контрасты для читаемости
- Поддержка различных размеров экранов

## Различия по ролям

### Кассир

- Полный доступ к функциям оплаты
- Применение скидок в рамках лимитов
- Проведение возвратов

### Менеджер

- Дополнительно: применение любых скидок
- Авторизация крупных операций
- Доступ к отчетам по оплатам

### Администратор

- Настройка платежных систем
- Управление комиссиями и лимитами
- Мониторинг безопасности

## Критерии готовности

- [ ] Все способы оплаты работают корректно
- [ ] Расчет сдачи происходит точно
- [ ] Применение скидок функционирует правильно
- [ ] Печать документов работает стабильно
- [ ] Интеграция с фискальными регистраторами настроена
- [ ] Обработка ошибок происходит корректно
- [ ] Адаптивная верстка на всех устройствах

## Оценка сложности

**Высокая сложность** - комплексный интерфейс оплаты с множественными интеграциями и требованиями к безопасности.
