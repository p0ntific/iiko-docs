# Закрытие смены

## Краткое описание

Страница закрытия рабочей смены в системе iiko Front. Обеспечивает корректное завершение рабочего дня с подведением итогов, сверкой и формированием отчетности.

## Функциональные элементы

### Основные компоненты страницы

- **Итоги смены** - общая информация о продажах и операциях
- **Контрольный пересчет наличных** - сверка фактических и учетных остатков
- **Проверка незакрытых заказов** - список открытых заказов
- **Сверка платежей** - наличные, карты, прочие способы оплаты
- **Кнопка "Закрыть смену"** - подтверждение закрытия
- **Кнопка печати Z-отчета** - финальный фискальный отчет
- **Кнопка "Отмена"** - возврат к рабочему режиму

### Функциональность

- Проверка незакрытых заказов
- Сверка наличных денежных средств
- Проверка безналичных платежей
- Формирование итоговых отчетов
- Завершение смены с фиксацией времени
- Резервное копирование данных

## Связи с другими страницами

### Входящие переходы

- **Рабочие страницы всех ролей** → при необходимости закрыть смену
- **[Кассовая смена](./cash-shift.md)** → завершение кассовых операций
- **Системные уведомления** → автоматическое напоминание о закрытии

### Исходящие переходы

- **Успешное закрытие** → [Страница входа](./login.md)
- **Ошибки закрытия** → Соответствующие страницы устранения проблем:
    - **Незакрытые заказы** → [Управление заказами](./order-management.md)
    - **Расхождения в кассе** → Страница сверки наличности
    - **Проблемы с ФР** → [Настройки оборудования](./equipment-settings.md)
- **Печать отчетов** → [Отчеты](./reports.md)

### Контекстные переходы

- **Есть незакрытые заказы** → Принудительное закрытие или устранение
- **Расхождения в кассе** → Документирование причин
- **Ошибка Z-отчета** → Повторная попытка или техническая поддержка

## Бизнес-правила

### Последовательность закрытия смены

1. Проверка незакрытых заказов
2. Сверка наличных денежных средств
3. Проверка безналичных платежей
4. Формирование итоговых отчетов
5. Завершение смены

### Обязательные проверки

- Все заказы закрыты или документально обоснованы
- Денежные средства сверены и расхождения объяснены
- Фискальный регистратор готов к печати Z-отчета
- Резервное копирование данных выполнено

### Контрольный пересчет наличных

- Калькулятор номиналов для ввода количества купюр и монет
- Автоматический подсчет общей суммы
- Сравнение с учетными данными
- Поле для комментариев при расхождениях

## UX/UI требования

### Визуальные состояния

- **Обычное состояние** - отображение итогов смены
- **Состояние проверки** - процесс сверки данных
- **Состояние ошибки** - отображение проблем
- **Состояние успеха** - подтверждение закрытия смены

### Анимации

- Плавные переходы между этапами закрытия
- Анимация загрузки при формировании отчетов
- Пульсация кнопки при готовности к закрытию
- Fade-in для уведомлений об ошибках

### Адаптивность

- Адаптация под различные размеры экранов
- Оптимизация для планшетов и терминалов
- Поддержка сенсорного управления
- Четкое отображение итогов и статистики

## Различия по ролям

### Кассир

- Обязательная сверка наличных средств
- Контроль фискального регистратора
- Формирование Z-отчета

### Официант

- Подведение итогов личных продаж
- Контроль чаевых
- Сдача смены

### Повар

- Контроль списаний и потерь
- Учет рабочего времени
- Сдача кухонного оборудования

### Менеджер

- Контроль всех операций смены
- Утверждение итогов
- Формирование отчетности

## Критерии готовности

- [ ] Все незакрытые заказы обработаны
- [ ] Сверка наличных средств выполнена
- [ ] Z-отчет сформирован корректно
- [ ] Резервное копирование данных выполнено
- [ ] Переход на страницу входа работает
- [ ] Обработка ошибок происходит правильно
- [ ] Интерфейс адаптируется под различные устройства

## Оценка сложности

**Средняя сложность** - стандартная процедура закрытия смены с множественными проверками и формированием отчетности.
